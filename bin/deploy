#!/bin/sh

echo "Configure kubectl"
kubectl config set-cluster $CLUSTER_NAME --server=$CLUSTER_SERVER
kubectl config set-credentials codeship --token=$KUBERNETES_BEARER_TOKEN
kubectl config set-context $CLUSTER_NAME --cluster=$CLUSTER_NAME --user=codeship
kubectl config use-context $CLUSTER_NAME
kubectl config current-context
echo "Deploying commit-$CI_COMMIT_ID"
REVISION=$CI_COMMIT_ID ENVIRONMENT=production kubernetes-deploy default $CLUSTER_NAME
